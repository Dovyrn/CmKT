<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logical Zoom Config - Basic Interface</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #1f2937;
            color: #f3f4f6;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1, h2, h3 {
            color: #4f46e5;
        }
        .card {
            background-color: #111827;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            background-color: rgba(16, 185, 129, 0.2);
            border: 1px solid #10b981;
        }
        .error {
            background-color: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
        }
        .info {
            background-color: rgba(59, 130, 246, 0.2);
            border: 1px solid #3b82f6;
        }
        button {
            background-color: #4f46e5;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 16px;
            cursor: pointer;
            margin-right: 8px;
            margin-bottom: 8px;
        }
        button:hover {
            background-color: #4338ca;
        }
        pre {
            background-color: #374151;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #374151;
        }
        th {
            background-color: #374151;
        }
        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 10px;
        }
        .module-card {
            background-color: #111827;
            border-radius: 4px;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #374151;
            transition: .4s;
            border-radius: 24px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #4f46e5;
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        .tab-buttons {
            display: flex;
            margin-bottom: 20px;
        }
        .tab-buttons button {
            background: #374151;
            margin-right: 5px;
        }
        .tab-buttons button.active {
            background: #4f46e5;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Logical Zoom - Basic Configuration Interface</h1>
    <div id="status-message" class="status info">Loading configuration...</div>

    <div class="tab-buttons" id="tab-buttons">
        <button class="active" data-tab="modules">Modules</button>
        <button data-tab="config">Raw Config</button>
        <button data-tab="metadata">Config Metadata</button>
    </div>

    <div class="tab-content active" id="modules-tab">
        <h2>Module Overview</h2>
        <div id="modules-container">Loading modules...</div>

        <div class="card">
            <h3>Actions</h3>
            <button id="save-changes">Save Changes</button>
            <button id="reset-config">Reset to Defaults</button>
        </div>
    </div>

    <div class="tab-content" id="config-tab">
        <h2>Raw Configuration</h2>
        <pre id="config-data">Loading configuration...</pre>
    </div>

    <div class="tab-content" id="metadata-tab">
        <h2>Configuration Metadata</h2>
        <pre id="metadata">Loading metadata...</pre>
    </div>
</div>

<script>
    // Store configuration data
    let configData = null;
    let metadataData = null;
    let modulesData = null;
    let pendingChanges = {};

    // DOM elements
    const statusMessage = document.getElementById('status-message');
    const configDisplay = document.getElementById('config-data');
    const metadataDisplay = document.getElementById('metadata');
    const modulesContainer = document.getElementById('modules-container');

    // Initialize
    document.addEventListener('DOMContentLoaded', async () => {
        try {
            await loadConfig();
            await loadModules();
            setupTabs();
            setupActions();

            statusMessage.textContent = 'Configuration loaded successfully';
            statusMessage.className = 'status success';
        } catch (error) {
            statusMessage.textContent = `Error: ${error.message}`;
            statusMessage.className = 'status error';
        }
    });

    // Load configuration
    async function loadConfig() {
        try {
            const response = await fetch('/api/config');
            if (!response.ok) {
                throw new Error(`Server returned ${response.status} ${response.statusText}`);
            }

            const data = await response.json();
            configData = data.values;
            metadataData = data.metadata;

            // Display raw config
            configDisplay.textContent = JSON.stringify(configData, null, 2);

            // Display metadata
            metadataDisplay.textContent = JSON.stringify(metadataData, null, 2);

            return data;
        } catch (error) {
            console.error('Error loading config:', error);
            throw error;
        }
    }

    // Load modules
    async function loadModules() {
        try {
            const response = await fetch('/api/modules');
            if (!response.ok) {
                throw new Error(`Server returned ${response.status} ${response.statusText}`);
            }

            modulesData = await response.json();
            renderModules();

            return modulesData;
        } catch (error) {
            console.error('Error loading modules:', error);
            throw error;
        }
    }

    // Render modules overview
    function renderModules() {
        modulesContainer.innerHTML = '';

        for (const category in modulesData) {
            const categoryElement = document.createElement('div');
            categoryElement.className = 'card';

            const heading = document.createElement('h3');
            heading.textContent = category;
            categoryElement.appendChild(heading);

            const grid = document.createElement('div');
            grid.className = 'module-grid';

            for (const moduleName in modulesData[category]) {
                const enabled = modulesData[category][moduleName];
                const moduleEl = createModuleCard(moduleName, enabled);
                grid.appendChild(moduleEl);
            }

            categoryElement.appendChild(grid);
            modulesContainer.appendChild(categoryElement);
        }
    }

    // Create a module card
    function createModuleCard(name, enabled) {
        const card = document.createElement('div');
        card.className = 'module-card';

        const nameEl = document.createElement('div');
        nameEl.textContent = name;

        const toggleEl = document.createElement('label');
        toggleEl.className = 'switch';

        const inputEl = document.createElement('input');
        inputEl.type = 'checkbox';
        inputEl.checked = enabled;

        const configKey = findConfigKeyForModule(name);
        if (configKey) {
            card.dataset.configKey = configKey;

            // Add change listener
            inputEl.addEventListener('change', function() {
                pendingChanges[configKey] = this.checked;
                statusMessage.textContent = 'Changes pending. Click "Save Changes" to apply.';
                statusMessage.className = 'status info';
            });
        }

        const sliderEl = document.createElement('span');
        sliderEl.className = 'slider';

        toggleEl.appendChild(inputEl);
        toggleEl.appendChild(sliderEl);

        card.appendChild(nameEl);
        card.appendChild(toggleEl);

        return card;
    }

    // Find config key for a module name
    function findConfigKeyForModule(moduleName) {
        // Common patterns
        const patterns = [
            moduleName.toLowerCase() + 'Enabled',
            moduleName.replace(/\s+/g, '') + 'Enabled',
            moduleName.replace(/\s+/g, '').toLowerCase() + 'Enabled',
            moduleName.replace(/\s+/g, '') + 'Toggled',
            moduleName.toLowerCase().replace(/\s+/g, ''),
        ];

        // Check each pattern
        for (const pattern of patterns) {
            if (pattern in configData) {
                return pattern;
            }
        }

        // Special cases
        const specialCases = {
            'Target HUD': 'targetHudToggled',
            'ESP': 'espEnabled',
            'Storage ESP': 'storageEspEnabled',
            'Sprint': 'sprint',
            'No Jump Delay': 'noJumpDelay',
            'Full Bright': 'fullBright',
            'Mace Dive': 'maceDiveEnabled',
            'Mace D-Tap': 'maceDTap',
            'Hitbox': 'HitboxEnabled',
            'Weapon Swapper': 'weaponSwapper',
            'Aim Assist': 'aimAssistEnabled',
            'Chams': 'chamsEnabled'
        };

        return specialCases[moduleName] || null;
    }

    // Set up tabs
    function setupTabs() {
        const tabs = document.querySelectorAll('.tab-buttons button');

        tabs.forEach(tab => {
            tab.addEventListener('click', function() {
                // Remove active class from all tabs
                tabs.forEach(t => t.classList.remove('active'));

                // Add active class to clicked tab
                this.classList.add('active');

                // Hide all tab content
                document.querySelectorAll('.tab-content').forEach(
                    content => content.classList.remove('active')
                );

                // Show selected tab content
                const tabId = this.dataset.tab;
                document.getElementById(`${tabId}-tab`).classList.add('active');
            });
        });
    }

    // Set up action buttons
    function setupActions() {
        // Save changes
        document.getElementById('save-changes').addEventListener('click', async () => {
            if (Object.keys(pendingChanges).length === 0) {
                statusMessage.textContent = 'No changes to save';
                statusMessage.className = 'status info';
                return;
            }

            statusMessage.textContent = 'Saving changes...';
            statusMessage.className = 'status info';

            try {
                const response = await fetch('/api/config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(pendingChanges)
                });

                if (!response.ok) {
                    throw new Error(`Server returned ${response.status}`);
                }

                // Update local config
                for (const key in pendingChanges) {
                    configData[key] = pendingChanges[key];
                }

                // Update displays
                configDisplay.textContent = JSON.stringify(configData, null, 2);

                // Clear pending changes
                pendingChanges = {};

                statusMessage.textContent = 'Changes saved successfully';
                statusMessage.className = 'status success';

                // Reload modules
                await loadModules();
            } catch (error) {
                statusMessage.textContent = `Error saving changes: ${error.message}`;
                statusMessage.className = 'status error';
            }
        });

        // Reset config
        document.getElementById('reset-config').addEventListener('click', async () => {
            if (!confirm('Are you sure you want to reset all settings to defaults?')) {
                return;
            }

            statusMessage.textContent = 'Resetting to defaults...';
            statusMessage.className = 'status info';

            try {
                const response = await fetch('/api/config/reset', {
                    method: 'POST'
                });

                if (!response.ok) {
                    throw new Error(`Server returned ${response.status}`);
                }

                statusMessage.textContent = 'Settings reset to defaults. Reloading...';
                statusMessage.className = 'status success';

                // Clear pending changes
                pendingChanges = {};

                // Reload everything after a brief delay
                setTimeout(async () => {
                    await loadConfig();
                    await loadModules();
                }, 1000);
            } catch (error) {
                statusMessage.textContent = `Error resetting settings: ${error.message}`;
                statusMessage.className = 'status error';
            }
        });
    }
</script>
</body>
</html>